<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Compras Supermercado</title>
    <link rel="stylesheet" href="css/estilo.css" />
  </head>
  <body>
    <div class="wrapper">
      <form action="" method="post" id="form">
        <legend>Lista de Compras</legend>

        <div class="colunas">
          <div>
            <label for="nome">Nome do Produto</label>
            <input type="text" id="nome" placeholder="Nome do Produto" />
          </div>
          <div>
            <label for="valor">Valor (R$)</label>
            <input
              type="number"
              step="0.01"
              id="valor"
              placeholder="Valor do Produto"
            />
          </div>
        </div>
        <input
          type="button"
          class="btn"
          value="Adicionar"
          onclick="adicionar()"
        />
      </form>
      <div class="lista">
        <h3>
          Lista
          <input
            type="text"
            id="busca"
            placeholder="Buscar Produto"
            onchange="buscar()"
          />
        </h3>
        <div id="saida"></div>
      </div>
      <div class="total">
        <h3>Total: R$ <span id="total">0.00</span></h3>
      </div>
    </div>
    <script>
      const produtos = [];

      function adicionar() {
        const nome = document.getElementById("nome").value;
        const valor = Number(document.getElementById("valor").value);
        const form = document.getElementById("form");

        if (nome == "" || valor == "") {
          alert("Insira todos os campos do Produto");
          return;
        }

        if (valor <= 0) {
          alert("O valor do produto está inválido");
          return;
        }

        // Verifica se já existe esse produto na lista
        var seExiste = produtos.find(function(element) {
          if (element[0] === nome) return true;
        });

        if (seExiste) {
          alert("O produto já existe na lista");
          return;
        }

        produtos.push([nome, valor]);

        form.reset(); // limpa o formulário
        exibir();
        total();
      }

      function exibir(filtro = "") {
        /* Criar a lista de Produtos */
        const lista = document.createElement("ul");
        let listaExibir = [];

        if (filtro !== "") {
          listaExibir = produtos.filter(function(produto) {
            return produto[0].includes(filtro);
          });
        } else {
          listaExibir = produtos;
        }

        listaExibir.forEach(function(item) {
          const listaItem = document.createElement("li");
          const texto = document.createTextNode(item[0] + " - R$ " + item[1]);
          listaItem.append(texto);
          lista.append(listaItem);
        });

        const saida = document.getElementById("saida");
        saida.innerHTML = "";
        saida.append(lista);
      }

      function total() {
        var listaValores = produtos.map(soPrimeiro);
        var total = listaValores.reduce(soma);

        const totalEl = document.getElementById("total");
        totalEl.innerText = total;
      }

      function buscar() {
        var busca = document.getElementById("busca").value;
        exibir(busca);
      }

      function soma(a, b) {
        return a + b;
      }

      function soPrimeiro(item) {
        return item[1];
      }
    </script>
  </body>
</html>
